<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrar Productos</title>
    <style>
        #mensaje {
            color: red;
            font-weight: bold;
        }
    </style>
    <script>
        function validarFormulario(event) {
            event.preventDefault(); // Evita envío inmediato

            const nombre = document.getElementsByName("nombre")[0].value.trim();
            const marca = document.getElementsByName("marca")[0].value;
            const modelo = document.getElementsByName("modelo")[0].value.trim();
            const precio = parseFloat(document.getElementsByName("precio")[0].value);
            const detalles = document.getElementsByName("detalles")[0].value.trim();
            const unidades = parseInt(document.getElementsByName("unidades")[0].value);
            let imagen = document.getElementsByName("imagen")[0].value.trim();
            const mensaje = document.getElementById("mensaje");

            mensaje.textContent = ""; // Limpia mensajes previos

            // a. Nombre requerido y <= 100 caracteres
            if (nombre === "") {
                mensaje.textContent = "El campo 'Nombre' es obligatorio.";
                return false;
            }
            if (nombre.length > 100) {
                mensaje.textContent = "El campo 'Nombre' no puede tener más de 100 caracteres.";
                return false;
            }

            // b. Marca requerida y seleccionada
            if (marca === "") {
                mensaje.textContent = "Debe seleccionar una 'Marca'.";
                return false;
            }

            // c. Modelo requerido, alfanumérico y <= 25 caracteres
            if (modelo === "") {
                mensaje.textContent = "El campo 'Modelo' es obligatorio.";
                return false;
            }
            if (modelo.length > 25) {
                mensaje.textContent = "El campo 'Modelo' no puede tener más de 25 caracteres.";
                return false;
            }
            const regexAlfanumerico = /^[A-Za-z0-9]+$/;
            if (!regexAlfanumerico.test(modelo)) {
                mensaje.textContent = "El campo 'Modelo' solo puede contener caracteres alfanuméricos.";
                return false;
            }

            // d. Precio requerido y > 99.99
            if (isNaN(precio)) {
                mensaje.textContent = "El campo 'Precio' es obligatorio.";
                return false;
            }
            if (precio <= 99.99) {
                mensaje.textContent = "El precio debe ser mayor a 99.99.";
                return false;
            }

            // e. Detalles opcional, pero <= 250 caracteres si se usa
            if (detalles.length > 250) {
                mensaje.textContent = "El campo 'Detalles' no puede tener más de 250 caracteres.";
                return false;
            }

            // f. Unidades requeridas y >= 0
            if (isNaN(unidades)) {
                mensaje.textContent = "El campo 'Unidades' es obligatorio.";
                return false;
            }
            if (unidades < 0) {
                mensaje.textContent = "El número de unidades no puede ser negativo.";
                return false;
            }

            // g. Imagen opcional, pero usar valor por defecto si está vacío
            if (imagen === "") {
                imagen = "img/default.png";
                document.getElementsByName("imagen")[0].value = imagen; // asigna el valor al campo
            }

            // Si pasa todas las validaciones, se envía el formulario
            mensaje.style.color = "green";
            mensaje.textContent = "Formulario válido. Enviando datos...";
            document.getElementById("formulario_productos").submit();
        }
    </script>
</head>
<body>
    <h1>Registro de Productos Nuevos</h1>

    <form id="formulario_productos" 
          action="http://localhost/tecweb/practicas/p09/set_productoV2.php" 
          method="post"
          onsubmit="validarFormulario(event)">
        <fieldset>
            <legend>Ingrese la información del producto a registrar</legend>
            <ul>
                <li>Nombre: <input type="text" name="nombre"></li>
                <li>Marca: 
                    <select name="marca">
                        <option value="">--Seleccione una marca--</option>
                        <option value="MSI">MSI</option>
                        <option value="XPG">XPG</option>
                        <option value="Kingston">Kingston</option>
                        <option value="Asus">Asus</option>
                        <option value="Gigabyte">Gigabyte</option>
                    </select>
                </li>
                <li>Modelo: <input type="text" name="modelo"></li>
                <li>Precio: <input type="number" step="0.01" name="precio"></li>
                <li>Detalles: <input type="text" name="detalles"></li>
                <li>Unidades: <input type="number" name="unidades"></li>
                <li>Imagen: <input type="text" name="imagen" placeholder="img/producto.png"></li>
            </ul>
        </fieldset>
        <p>
            <input type="submit" value="Enviar">
            <input type="reset" value="Limpiar">
        </p>
    </form>

    <p id="mensaje"></p>
</body>
</html>
